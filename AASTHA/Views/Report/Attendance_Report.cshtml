<link rel="stylesheet" href="~/Content/js/icheck/skins/square/_all.css" id="style-resource-2">

<div ng-app="mainApp" ng-controller="MainController" data-ng-init="getreport()">
    <div class="row">
        <div class="col-md-1 pull-right" ng-if="patients.length != 0">
            <div class="form-group" style="margin-top:25px;">
                <input type="button" class="btn btn-info" value="Print" id="btnprint" ng-click="print()" />
            </div>
        </div>
        <div class="col-md-1 pull-right">
            <div class="form-group" style="margin-top:25px;">
                <input type="button" class="btn btn-primary" value="Submit" id="btnreport" ng-click="getreport()" />
            </div>
        </div>

        <div id="daily">
            <div class="col-md-3 pull-right">
                <div class="form-group">
                    <label for="field-4" class="control-label">Date</label>
                    <input type="text" class="form-control datepicker" id="reportdate">
                </div>
            </div>
        </div>

    </div>
    <hr />
    <div class="printable">
        <h3 style="text-align:center">Monthly Attendance Report</h3>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Staff Name</th>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                    <th>8</th>
                    <th>9</th>
                    <th>10</th>
                    <th>11</th>
                    <th>12</th>
                    <th>13</th>
                    <th>14</th>
                    <th>15</th>
                    <th>16</th>
                    <th>17</th>
                    <th>18</th>
                    <th>19</th>
                    <th>20</th>
                    <th>21</th>
                    <th>22</th>
                    <th>23</th>
                    <th>24</th>
                    <th>25</th>
                    <th>26</th>
                    <th>27</th>
                    <th>28</th>
                    <th>29</th>
                    <th>30</th>
                    <th ng-if="monthdays == 31">31</th>
                    <th>P</th>
                    <th>A</th>
                </tr>
            </thead>
            <tbody ng-repeat="(grpkey, value) in patients | groupBy: 'date'">
                <tr ng-repeat="item in value">
                    <td>{{$index+1}}</td>
                    <td>{{ item.username }} </td>
                    <td ng-class="(item.C1=='A') ? 'error' : ''">{{ item.C1 }}</td>
                    <td ng-class="(item.C2=='A') ? 'error' : ''">{{ item.C2 }}</td>
                    <td ng-class="(item.C3=='A') ? 'error' : ''">{{ item.C3 }}</td>
                    <td ng-class="(item.C4=='A') ? 'error' : ''">{{ item.C4 }}</td>
                    <td ng-class="(item.C5=='A') ? 'error' : ''">{{ item.C5 }}</td>
                    <td ng-class="(item.C6=='A') ? 'error' : ''">{{ item.C6 }}</td>
                    <td ng-class="(item.C7=='A') ? 'error' : ''">{{ item.C7 }}</td>
                    <td ng-class="(item.C8=='A') ? 'error' : ''">{{ item.C8 }}</td>
                    <td ng-class="(item.C9=='A') ? 'error' : ''">{{ item.C9 }}</td>
                    <td ng-class="(item.C10=='A') ? 'error' : ''">{{ item.C10 }}</td>
                    <td ng-class="(item.C11=='A') ? 'error' : ''">{{ item.C11 }}</td>
                    <td ng-class="(item.C12=='A') ? 'error' : ''">{{ item.C12 }}</td>
                    <td ng-class="(item.C13=='A') ? 'error' : ''">{{ item.C13 }}</td>
                    <td ng-class="(item.C14=='A') ? 'error' : ''">{{ item.C14 }}</td>
                    <td ng-class="(item.C15=='A') ? 'error' : ''">{{ item.C15 }}</td>
                    <td ng-class="(item.C16=='A') ? 'error' : ''">{{ item.C16 }}</td>
                    <td ng-class="(item.C17=='A') ? 'error' : ''">{{ item.C17 }}</td>
                    <td ng-class="(item.C18=='A') ? 'error' : ''">{{ item.C18 }}</td>
                    <td ng-class="(item.C19=='A') ? 'error' : ''">{{ item.C19 }}</td>
                    <td ng-class="(item.C20=='A') ? 'error' : ''">{{ item.C20 }}</td>
                    <td ng-class="(item.C21=='A') ? 'error' : ''">{{ item.C21 }}</td>
                    <td ng-class="(item.C22=='A') ? 'error' : ''">{{ item.C22 }}</td>
                    <td ng-class="(item.C23=='A') ? 'error' : ''">{{ item.C23}}</td>
                    <td ng-class="(item.C24=='A') ? 'error' : ''">{{ item.C24 }}</td>
                    <td ng-class="(item.C25=='A') ? 'error' : ''">{{ item.C25 }}</td>
                    <td ng-class="(item.C26=='A') ? 'error' : ''">{{ item.C26 }}</td>
                    <td ng-class="(item.C27=='A') ? 'error' : ''">{{ item.C27 }}</td>
                    <td ng-class="(item.C28=='A') ? 'error' : ''">{{ item.C28 }}</td>
                    <td ng-class="(item.C29=='A') ? 'error' : ''">{{ item.C29 }}</td>
                    <td ng-class="(item.C30=='A') ? 'error' : ''">{{ item.C30 }}</td>
                    <td ng-class="(item.C31=='A') ? 'error' : ''" ng-if="monthdays == 31">{{ item.C31 }}</td>
                    <td>{{item.PresentDays}}</td>
                    <td>{{monthdays- item.PresentDays}}</td>
                </tr>

            </tbody>
            <tr ng-if="patients.length == 0">
                <td colspan="35" style="text-align:left">No Record Found</td>
            </tr>
        </table>
    </div>
</div>

<script src="~/Scripts/angular.min.js"></script>
<script src="~/Scripts/angular-filter.js"></script>
<script src="~/Content/js/bootstrap-datepicker.js"></script>
<script src="~/Scripts/jQuery.print.js"></script>
<script src="~/Content/js/icheck/icheck.min.js"></script>

<script>
    $('input.icheck-11').iCheck({
        radioClass: 'iradio_square-blue'
    });

    $("#range").hide();
    $('input').on('ifClicked', function (ev) {
        if (this.value == 'Daily') {
            $("#range").hide();
            $("#daily").show();
        }
        else if (this.value == 'Range') {
            $("#daily").hide();
            $("#range").show();
        }
        else {
            $("#range").hide();
            $("#daily").show();
        }
    });
    angular.module('mainApp', ['angular.filter'])
    .controller('MainController', function ($scope, $http) {
        $scope.getreport = function () {
            blockui();
            var reportdate = $("#reportdate").val();
            $http.get(
            "Get_MonthlyAttendance_Report/Report",
            { params: { date: reportdate } })
             .success(function (response) {
                 unblockui();
                 $scope.patients = response;
             });

            if (reportdate == "") {
                $scope.monthdays = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            }
            else {
                var splitdate = reportdate.split("/");
                $scope.monthdays = new Date(splitdate[2], splitdate[1], 0).getDate();
            }
        }
        $scope.print = function () {
            $(".printable").print();
        }
    });
</script>
<style>
    .icheck-list > li {
        display: inline;
        margin-bottom: 10px;
    }

    #prt-container table {
        border-collapse: collapse;
    }

    #prt-container th,
    #prt-container td {
        border: 1px solid black;
    }

    .datatable_loader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url('../Content/loader.gif') 50% 50% no-repeat rgba(249,249,249,.7);
    }

    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
        padding: 4px;
    }

    table thead tr th {
        font-size: 12px;
    }

    td {
        font-size: 12px;
    }

    .copyButton {
        background: #ff0000;
    }

    .tabletitle {
        font-weight: bold;
    }

    .tablefooter {
        font-weight: bold;
        text-decoration: underline;
    }
</style>